<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–∞—Ä–∫–µ—Ä –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: #f9f9f9;
    }
    h3 { color: #333; }
    input {
      padding: 8px;
      margin: 5px;
      width: 300px;
    }
    button {
      padding: 8px 16px;
      background: #4CAF50;
      border: none;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
    #status { margin-top: 20px; font-weight: bold; }
    #history { margin-top: 30px; background: #fff; padding: 15px; border-radius: 8px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h3>–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</h3>
  <input id="url" type="text" placeholder="–í—Å—Ç–∞–≤—å URL">
  <input id="title" type="text" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
  <button onclick="addUrl()">–î–æ–±–∞–≤–∏—Ç—å</button>

  <h3>–°—Ç–∞—Ç—É—Å:</h3>
  <pre id="status"></pre>

  <div id="history">
    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
    <table id="linksTable">
      <thead>
        <tr><th>–î–∞—Ç–∞</th><th>URL</th><th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th><th>–°—Ç–∞—Ç—É—Å</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // üëâ –í–°–¢–ê–í–¨ –°–í–û–ô URL –æ—Ç Google Apps Script
    const scriptURL = "–í–°–¢–ê–í–¨_–°–°–´–õ–ö–£_–ù–ê_WEB_APP";

    async function addUrl() {
      let url = document.getElementById("url").value.trim();
      let title = document.getElementById("title").value.trim();
      if (!url) return;

      try {
        let response = await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify({ url, title }),
          headers: { "Content-Type": "application/json" }
        });

        let result = await response.json();
        document.getElementById("status").textContent = 
          `–°—Å—ã–ª–∫–∞: ${url}\n–°—Ç–∞—Ç—É—Å: ${result.status}`;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        loadHistory();
      } catch (e) {
        document.getElementById("status").textContent = "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏!";
      }
    }

    async function loadHistory() {
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º CSV-–≤–µ—Ä—Å–∏—é —Ç–∞–±–ª–∏—Ü—ã
        const sheetId = "1WfhbuFEuC_mbXac8HXxXZTN5CJIGQf5SCM4d_F8MqXc"; // ‚ö° –≤–æ–∑—å–º–∏ ID –∏–∑ —Å—Å—ã–ª–∫–∏ –Ω–∞ Google Sheet
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv`;
        let res = await fetch(url);
        let csv = await res.text();

        let rows = csv.trim().split("\n").map(r => r.split(","));
        let tbody = document.querySelector("#linksTable tbody");
        tbody.innerHTML = "";

        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É (–∑–∞–≥–æ–ª–æ–≤–∫–∏) –∏ –±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10
        rows.slice(1).slice(-10).reverse().forEach(r => {
          let tr = document.createElement("tr");
          tr.innerHTML = `<td>${r[0]}</td><td><a href="${r[1]}" target="_blank">${r[1]}</a></td><td>${r[2]}</td><td>${r[3]}</td>`;
          tbody.appendChild(tr);
        });

      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏", e);
      }
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadHistory();
  </script>
</body>
</html>
